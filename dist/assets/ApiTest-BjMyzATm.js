import{r as x,d as Z,o as ee,g as h,q as o,y as d,A as u,k as c,x as m,u as r,D as y,B as g,z as p,E as te}from"./vendor-BU-5murH.js";import{a as v,_ as k}from"./card-content.vue_vue_type_script_setup_true_lang-BUO1Kpj1.js";import{a as b}from"./index-DMU_U8j6.js";import{R as w}from"./ui-C3Nfw3T3.js";class se{legacyBaseUrl;v3BaseUrl;transformers;constructor(e,s){this.legacyBaseUrl=e,this.v3BaseUrl=s,this.transformers=new Map,this.registerTransformers()}registerTransformers(){this.transformers.set("grades",this.transformGrades),this.transformers.set("custom-grades",this.transformCustomGrades),this.transformers.set("batches",this.transformBatches),this.transformers.set("boards",this.transformBoards),this.transformers.set("bundles",this.transformBundles),this.transformers.set("species",this.transformLookupData),this.transformers.set("thickness",this.transformLookupData),this.transformers.set("suppliers",this.transformLookupData),this.transformers.set("graders",this.transformLookupData),this.transformers.set("markets",this.transformLookupData),this.transformers.set("auth",this.transformAuth)}async request(e,s={}){try{const t=this.mapToLegacyEndpoint(e),i=this.transformRequestOptions(s,e),n=await fetch(`${this.legacyBaseUrl}${t}`,i);if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const l=await n.json();return l.status==="error"||l.errors?this.handleError(new Error(l.message||"API request failed")):this.transformResponse(e,l)}catch(t){return this.handleError(t)}}mapToLegacyEndpoint(e){const s={"/api/v3/grades":"/grades","/api/v3/custom-grades":"/custom-grades","/api/v3/batches":"/batches","/api/v3/batches/open":"/batches/open","/api/v3/bundles":"/bundles","/api/v3/boards":"/boards","/api/v3/species":"/species","/api/v3/thickness":"/thicknessValues","/api/v3/suppliers":"/suppliers","/api/v3/graders":"/graders","/api/v3/markets":"/markets","/api/v3/auth/login":"/auth/login","/api/v3/auth/validate":"/auth/validate-token","/api/v3/auth/register":"/auth/register","/api/v3/defect-types":"/defect-types","/api/v3/attributes":"/attributes","/api/v3/system-properties":"/system-properties","/api/v3/units":"/units","/api/v3/dry-statuses":"/dryStatuses","/api/v3/printers":"/printers","/api/v3/feedback-categories":"/feedback-categories"},t=e.match(/^(\/api\/v3\/[^\/]+)(\/\d+)?(.*)$/);if(t){const i=t[1],n=t[2]||"",l=t[3]||"";return`${s[i]||i.replace("/api/v3","")}${n}${l}`}return s[e]||e.replace("/api/v3","")}transformRequestOptions(e,s){const t=new Headers(e.headers);if(t.has("Content-Type")||t.set("Content-Type","application/json; charset=utf-8"),t.has("Accept")||t.set("Accept","application/json; charset=utf-8"),s&&(s.includes("/auth/")||s.includes("/user")||s.includes("/admin")||s.includes("/private")||s.includes("/claims")||s.includes("/shifts"))){const n=localStorage.getItem("auth_token");n&&!t.has("Authorization")&&t.set("Authorization",`Bearer ${n}`)}return e.body&&typeof e.body=="object"&&(e.body=JSON.stringify(this.transformRequestBody(e.body))),{...e,headers:t}}transformRequestBody(e){return e.grades?{customGrades:e.grades,timestamp:new Date().toISOString()}:e.batch?{name:e.batch.name,graderId:e.batch.graderId,supplierId:e.batch.supplierId,specieId:e.batch.specieId,dryStatusId:e.batch.dryStatusId,thicknessValueId:e.batch.thicknessId,customGrades:e.batch.customGrades}:e}transformResponse(e,s){const t=this.getResourceType(e),i=this.transformers.get(t);return i?i.call(this,s):{data:s.data,meta:{timestamp:new Date().toISOString(),version:"3.0.0"}}}getResourceType(e){const s=[{regex:/\/auth\//,type:"auth"},{regex:/\/custom-grades/,type:"custom-grades"},{regex:/\/grades/,type:"grades"},{regex:/\/batches/,type:"batches"},{regex:/\/boards/,type:"boards"},{regex:/\/bundles/,type:"bundles"},{regex:/\/species/,type:"species"},{regex:/\/thickness/,type:"thickness"},{regex:/\/suppliers/,type:"suppliers"},{regex:/\/graders/,type:"graders"},{regex:/\/markets/,type:"markets"}];for(const t of s)if(t.regex.test(e))return t.type;return"default"}transformGrades(e){let s=[];if((e.status==="success"||Number(e.status)===200)&&Array.isArray(e.data))s=e.data;else if(e.data){const t=e.data?.data||e.data||[];s=Array.isArray(t)?t:[]}return{data:s,meta:{timestamp:new Date().toISOString(),version:"3.0.0"}}}transformCustomGrades(e){let s=[];if((e.status==="success"||Number(e.status)===200)&&Array.isArray(e.data))s=e.data;else if(e.data){const t=e.data?.data||e.data||[];s=Array.isArray(t)?t:[]}return{data:s.map(t=>({id:t.id,name:t.name,printLabel:t.printLabel,sortingBin:t.sortingBin,deleted:t.deleted||!1})),meta:{timestamp:new Date().toISOString(),version:"3.0.0"}}}transformBatches(e){let s=[];if((e.status==="success"||Number(e.status)===200)&&Array.isArray(e.data))s=e.data;else if(e.data){const t=e.data?.data||e.data||[];s=Array.isArray(t)?t:[]}return{data:s.map(t=>({id:t.id,name:t.name,specie:t.specie,thickness:t.thickness,dryStatus:t.dryStatus,graderId:t.graderId,supplierId:t.supplierId,status:t.status,startDate:t.startDate,closeDate:t.closeDate,boardsCount:t.boardsCount,customGrades:t.customGrades||[],lumberStage:t.lumberStage})),meta:{timestamp:new Date().toISOString(),version:"3.0.0"}}}transformBoards(e){let s=[];if((e.status==="success"||Number(e.status)===200)&&Array.isArray(e.data))s=e.data;else if(e.data){const t=e.data;s=t.data||t.boards||[],Array.isArray(s)||(s=[])}return{data:s.map(t=>{let i=t.gradeId,n=t.gradeName;if(!i&&t.grades&&t.grades.length>0){const l=t.grades.find(_=>_.valid===!0);l?i=l.id:(n="Rebut",i=4)}return{id:t.id,shotId:t.shotId,batchId:t.batch?.id||t.batchId,batchName:t.batch?.name,bundleId:t.bundleId,gradeId:i,gradeName:n,customGradeId:t.customGradeId,length:t.length,width:t.width,thickness:t.thickness,surface:t.surface,volume:t.volume?.value||t.volume,volumeGraded:t.volumeGraded?.value||t.volumeGraded,species:t.specie||t.species,dryStatus:t.dryStatus,createDate:t.createDate,defects:t.defects||[],face1:t.face1||null,face2:t.face2||null,faces:[t.face1,t.face2].filter(Boolean)||t.faces||[],grades:t.grades||[]}}),meta:{timestamp:new Date().toISOString(),version:"3.0.0"}}}transformBundles(e){const s=e.data||{},t=s.data||s.bundles||[];return{data:{bundles:(Array.isArray(t)?t:[]).map(n=>({id:n.id,batchId:n.batchId,status:n.status,boardCount:n.boardCount,totalVolume:n.totalVolume,gradeDistribution:n.gradeDistribution||{},createDate:n.createDate,closeDate:n.closeDate})),pagination:s.pagination},meta:{timestamp:new Date().toISOString(),version:"3.0.0"}}}transformLookupData(e){let s=[];return(e.status==="success"||Number(e.status)===200)&&Array.isArray(e.data)?s=e.data:e.data&&(Array.isArray(e.data)?s=e.data:e.data.data?s=Array.isArray(e.data.data)?e.data.data:[]:typeof e.data=="object"&&(s=Object.values(e.data))),{data:s.map(t=>({id:t.id,name:t.name||t.label||t.defaultName,description:t.description,active:t.active!==!1,selected:t.selected,metadata:t.metadata||{}})),meta:{timestamp:new Date().toISOString(),version:"3.0.0"}}}transformAuth(e){return e.token||e.accessToken||e.data?.token?{data:{token:e.token||e.accessToken||e.data?.token,refreshToken:e.refreshToken||e.data?.refreshToken,expiresIn:e.expiresIn||e.data?.expiresIn||3600,user:{id:e.userId||e.data?.userId,username:e.username||e.data?.username,roles:e.roles||e.data?.roles||[],permissions:e.permissions||e.data?.permissions||[]}},meta:{timestamp:new Date().toISOString(),version:"3.0.0"}}:this.handleError(new Error("Invalid authentication response"))}handleError(e){return{data:null,error:{code:e.code||"UNKNOWN_ERROR",message:e.message||"An unexpected error occurred"},meta:{timestamp:new Date().toISOString(),version:"3.0.0"}}}}class ae{adapter;cache;cacheTimeout=300*1e3;constructor(){const e="http://192.168.111.132:8082/processing",s="/api/v3";this.adapter=new se(e,s),this.cache=new Map}getCacheKey(e,s){return`${e}:${JSON.stringify(s||{})}`}getFromCache(e){const s=this.cache.get(e);return s?Date.now()-s.timestamp>this.cacheTimeout?(this.cache.delete(e),null):s.data:null}setCache(e,s){this.cache.set(e,{data:s,timestamp:Date.now()})}async get(e,s){const t=this.getCacheKey(e,s),i=this.getFromCache(t);if(i)return i;let n="";s&&Object.keys(s).length>0&&(n="?"+new URLSearchParams(s).toString());const l=await this.adapter.request(`${e}${n}`,{method:"GET"});return l.error||this.setCache(t,l),l}async post(e,s){return this.adapter.request(e,{method:"POST",body:s})}async put(e,s){return this.adapter.request(e,{method:"PUT",body:s})}async delete(e){return this.adapter.request(e,{method:"DELETE"})}clearCache(){this.cache.clear()}}const J=new ae;function S(D,e={}){const s=x(null),t=x(!1),i=x(null),n=async _=>{t.value=!0,i.value=null;try{const f=await J.get(D,_);if(f.error)throw new Error(f.error.message);return s.value=f.data,e.onSuccess?.(f.data),f}catch(f){return i.value=f,e.onError?.(f),null}finally{t.value=!1}},l=async()=>(e.cache||J.clearCache(),await n());return e.immediate&&n(),{data:s,loading:t,error:i,execute:n,refresh:l}}const re={class:"p-8 space-y-6"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ie={key:0,class:"mt-2 text-red-500 text-sm"},oe={key:1,class:"mt-2 text-sm"},de={class:"bg-gray-100 p-2 rounded overflow-auto max-h-40"},ue={key:0,class:"mt-2 text-red-500 text-sm"},ce={key:1,class:"mt-2 text-sm"},le={class:"bg-gray-100 p-2 rounded overflow-auto max-h-40"},me={key:0,class:"mt-2 text-red-500 text-sm"},pe={key:1,class:"mt-2 text-sm"},he={class:"bg-gray-100 p-2 rounded overflow-auto max-h-40"},fe={key:0,class:"mt-2 text-red-500 text-sm"},ge={key:1,class:"mt-2 text-sm"},ve={class:"bg-gray-100 p-2 rounded overflow-auto max-h-40"},ke={key:0,class:"mt-2 text-red-500 text-sm"},xe={key:1,class:"mt-2 text-sm"},_e={class:"bg-gray-100 p-2 rounded overflow-auto max-h-40"},ye={key:0,class:"mt-2 text-red-500 text-sm"},be={key:1,class:"mt-2 text-sm"},we={class:"bg-gray-100 p-2 rounded overflow-auto max-h-40"},Se={class:"space-y-1 text-sm"},Ce=Z({__name:"ApiTest",setup(D){const e="http://192.168.111.132:8082/processing",s="/api/v3",t=x("Testing..."),{data:i,loading:n,error:l,execute:_}=S("/api/v3/species"),f=()=>_({}),{data:E,loading:O,error:B,execute:P}=S("/api/v3/thickness"),K=()=>P(),{data:N,loading:L,error:G,execute:M}=S("/api/v3/batches"),F=()=>M({pageNumber:0,pageSize:10}),{data:$,loading:R,error:q,execute:H}=S("/api/v3/custom-grades"),W=()=>H({page:0,size:10}),{data:U,loading:z,error:V,execute:Q}=S("/api/v3/batches/open"),X=()=>Q(),I=x(null),A=x(null),T=x(!1),j=async()=>{T.value=!0,A.value=null,I.value=null;try{const C=`${e}/species`,a=await fetch(C);if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const Y=await a.json();I.value=Y,t.value="Connected"}catch(C){A.value=C.message||"Unknown error",t.value="Connection Failed"}finally{T.value=!1}};return ee(()=>{j()}),(C,a)=>(c(),h("div",re,[a[16]||(a[16]=o("h1",{class:"text-2xl font-bold"},"API Bridge Test",-1)),o("div",ne,[d(v,null,{default:u(()=>[d(k,{class:"p-4"},{default:u(()=>[a[1]||(a[1]=o("h2",{class:"text-lg font-semibold mb-2"},"Species",-1)),d(b,{onClick:f,disabled:r(n),variant:"outline",size:"sm"},{default:u(()=>[r(n)?(c(),y(r(w),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):m("",!0),a[0]||(a[0]=g(" Test /species ",-1))]),_:1,__:[0]},8,["disabled"]),r(l)?(c(),h("div",ie," Error: "+p(r(l).message),1)):m("",!0),r(i)?(c(),h("div",oe,[o("pre",de,p(JSON.stringify(r(i),null,2)),1)])):m("",!0)]),_:1,__:[1]})]),_:1}),d(v,null,{default:u(()=>[d(k,{class:"p-4"},{default:u(()=>[a[3]||(a[3]=o("h2",{class:"text-lg font-semibold mb-2"},"Thickness Values",-1)),d(b,{onClick:K,disabled:r(O),variant:"outline",size:"sm"},{default:u(()=>[r(O)?(c(),y(r(w),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):m("",!0),a[2]||(a[2]=g(" Test /thickness ",-1))]),_:1,__:[2]},8,["disabled"]),r(B)?(c(),h("div",ue," Error: "+p(r(B).message),1)):m("",!0),r(E)?(c(),h("div",ce,[o("pre",le,p(JSON.stringify(r(E),null,2)),1)])):m("",!0)]),_:1,__:[3]})]),_:1}),d(v,null,{default:u(()=>[d(k,{class:"p-4"},{default:u(()=>[a[5]||(a[5]=o("h2",{class:"text-lg font-semibold mb-2"},"Batches",-1)),d(b,{onClick:F,disabled:r(L),variant:"outline",size:"sm"},{default:u(()=>[r(L)?(c(),y(r(w),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):m("",!0),a[4]||(a[4]=g(" Test /batches ",-1))]),_:1,__:[4]},8,["disabled"]),r(G)?(c(),h("div",me," Error: "+p(r(G).message),1)):m("",!0),r(N)?(c(),h("div",pe,[o("pre",he,p(JSON.stringify(r(N),null,2)),1)])):m("",!0)]),_:1,__:[5]})]),_:1}),d(v,null,{default:u(()=>[d(k,{class:"p-4"},{default:u(()=>[a[7]||(a[7]=o("h2",{class:"text-lg font-semibold mb-2"},"Custom Grades",-1)),d(b,{onClick:W,disabled:r(R),variant:"outline",size:"sm"},{default:u(()=>[r(R)?(c(),y(r(w),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):m("",!0),a[6]||(a[6]=g(" Test /custom-grades ",-1))]),_:1,__:[6]},8,["disabled"]),r(q)?(c(),h("div",fe," Error: "+p(r(q).message),1)):m("",!0),r($)?(c(),h("div",ge,[o("pre",ve,p(JSON.stringify(r($),null,2)),1)])):m("",!0)]),_:1,__:[7]})]),_:1}),d(v,null,{default:u(()=>[d(k,{class:"p-4"},{default:u(()=>[a[9]||(a[9]=o("h2",{class:"text-lg font-semibold mb-2"},"Open Batch",-1)),d(b,{onClick:X,disabled:r(z),variant:"outline",size:"sm"},{default:u(()=>[r(z)?(c(),y(r(w),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):m("",!0),a[8]||(a[8]=g(" Test /batches/open ",-1))]),_:1,__:[8]},8,["disabled"]),r(V)?(c(),h("div",ke," Error: "+p(r(V).message),1)):m("",!0),r(U)?(c(),h("div",xe,[o("pre",_e,p(JSON.stringify(r(U),null,2)),1)])):m("",!0)]),_:1,__:[9]})]),_:1}),d(v,null,{default:u(()=>[d(k,{class:"p-4"},{default:u(()=>[a[11]||(a[11]=o("h2",{class:"text-lg font-semibold mb-2"},"Direct Legacy Test",-1)),d(b,{onClick:j,disabled:T.value,variant:"outline",size:"sm"},{default:u(()=>[T.value?(c(),y(r(w),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):m("",!0),a[10]||(a[10]=g(" Test Direct Connection ",-1))]),_:1,__:[10]},8,["disabled"]),A.value?(c(),h("div",ye," Error: "+p(A.value),1)):m("",!0),I.value?(c(),h("div",be,[o("pre",we,p(JSON.stringify(I.value,null,2)),1)])):m("",!0)]),_:1,__:[11]})]),_:1})]),d(v,null,{default:u(()=>[d(k,{class:"p-4"},{default:u(()=>[a[15]||(a[15]=o("h2",{class:"text-lg font-semibold mb-2"},"Connection Details",-1)),o("div",Se,[o("p",null,[a[12]||(a[12]=o("span",{class:"font-medium"},"Legacy URL:",-1)),g(" "+p(r(e)),1)]),o("p",null,[a[13]||(a[13]=o("span",{class:"font-medium"},"V3 Base:",-1)),g(" "+p(r(s)),1)]),o("p",null,[a[14]||(a[14]=o("span",{class:"font-medium"},"Status:",-1)),o("span",{class:te(t.value==="Connected"?"text-green-600":"text-orange-600")},p(t.value),3)])])]),_:1,__:[15]})]),_:1})]))}});export{Ce as default};
