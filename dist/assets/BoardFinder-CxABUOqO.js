import{r as i,c as v,o as ee,g,q as s,y as o,K as te,u as d,L as se,A as h,B as m,x as ae,E as C,z as l,I as re,J as ne,D as oe,l as le,k as u}from"./vendor-BU-5murH.js";import{B as ie}from"./BoardViewer-EEgKzL4M.js";import{_ as de,a as I}from"./index-DMU_U8j6.js";import{S as ce,W as ue,R as ge,P as me,Y as fe,_ as ve,$ as xe,a0 as pe}from"./ui-C3Nfw3T3.js";const he={class:"w-full px-4 sm:px-6 lg:px-8 py-6"},ye={class:"bg-white rounded-lg shadow p-4 mb-6"},be={class:"flex items-center justify-between"},_e={class:"flex items-center space-x-4 flex-1"},we={class:"relative flex-1 max-w-md"},ke={key:0,class:"ml-2 px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded-full text-xs"},Be={class:"flex gap-6"},Ce={class:"w-1/3 max-w-md"},Ie={class:"bg-white rounded-lg shadow-lg overflow-hidden"},Ne={class:"bg-gray-50 px-4 py-3 border-b border-gray-200"},Fe={class:"flex items-center justify-between"},De={class:"text-sm font-semibold text-gray-700"},Ae={class:"text-xs text-gray-500"},Le={class:"overflow-y-auto max-h-[calc(100vh-300px)]"},Ge={key:0,class:"p-4 text-center"},Re={key:1,class:"p-4 text-center text-gray-500"},Se={key:2},$e=["onClick"],Ve={class:"flex items-center justify-between"},je={class:"flex-1"},Me={class:"flex items-center gap-2"},Te={class:"font-semibold text-gray-900"},Pe={class:"text-xs text-gray-500"},ze={class:"flex items-center gap-3 mt-1"},Ue={class:"text-xs text-gray-600"},Ee={class:"text-xs text-gray-600"},Oe={class:"text-right"},We={class:"text-xs text-gray-500 mt-1"},qe={class:"bg-gray-50 px-4 py-3 border-t border-gray-200"},Je={class:"flex items-center justify-between"},Ke={class:"text-sm text-gray-600"},Qe={class:"flex-1"},Ye={key:0,class:"bg-white rounded-lg shadow-lg p-12 text-center"},He={class:"flex items-center px-3 py-1.5 text-sm font-medium text-gray-600 bg-white border-2 border-gray-300 rounded-md hover:bg-gray-50 transition-colors"},Xe={class:"flex items-center px-3 py-1.5 text-sm font-medium text-gray-600 bg-white border-2 border-gray-300 rounded-md hover:bg-gray-50 transition-colors"},Ze={__name:"BoardFinder",setup(et){const E=(e,t)=>{let a;return function(...G){const r=()=>{clearTimeout(a),e(...G)};clearTimeout(a),a=setTimeout(r,t)}},O=le(),y=i([]),f=i(null),b=i(""),R=i(!1),_=i(!1),S=i(null),N=i(25),c=i(1),w=i([]),F=i(null),x=i({orderId:null,gradeId:null,speciesId:null,lengthMin:null,lengthMax:null,widthMin:null,widthMax:null,hasDefects:null}),$=v(()=>Object.values(x.value).some(e=>e!==null&&e!=="")),p=v(()=>{let e=[...y.value];if(b.value){const t=b.value.toLowerCase();e=e.filter(a=>a.id?.toString().includes(t)||a.batch?.id?.toString().includes(t)||a.batch?.name?.toLowerCase().includes(t)||a.face1?.shotId?.toString().includes(t)||a.face2?.shotId?.toString().includes(t)||L(a).toLowerCase().includes(t)||P(a).toLowerCase().includes(t))}return x.value.orderId&&(e=e.filter(t=>t.batch?.id==x.value.orderId)),x.value.gradeId&&(e=e.filter(t=>t.gradeId==x.value.gradeId)),e}),D=v(()=>Math.ceil(p.value.length/N.value)),A=v(()=>(c.value-1)*N.value),V=v(()=>Math.min(A.value+N.value,p.value.length)),j=v(()=>p.value.slice(A.value,V.value)),M=async()=>{_.value=!0,S.value=null;try{const e=await fetch("/api/legacy/boards");if(!e.ok)throw new Error("Failed to fetch boards");const t=await e.json();y.value=t.data||[],y.value.length>0&&!f.value&&T(y.value[0])}catch(e){S.value=e.message,console.error("Error loading boards:",e)}finally{_.value=!1}},W=async()=>{try{const e=await fetch("/api/legacy/grades");if(!e.ok)throw new Error("Failed to fetch grades");const t=await e.json();w.value=t.data||[]}catch(e){console.error("Error loading grades:",e)}},T=e=>{f.value=e},q=()=>{R.value=!R.value},J=()=>{c.value>1&&c.value--},K=()=>{c.value<D.value&&c.value++},Q=()=>{f.value&&O.push(`/board-inspector/${f.value.id}`)},Y=e=>{console.log("Usable area toggled:",e)},k=e=>{const t={575:"AW",576:"AR",577:"BW",578:"BR",579:"CW",580:"CR",581:"Rebut"};return t[e]?t[e]:w.value.find(n=>n.id===e)?.name||`Grade ${e}`},L=e=>{if(!e?.gradeId){if(e?.grades&&e.grades.length>0){const a=e.grades.find(r=>r.valid?!k(r.id).toLowerCase().includes("rebut"):!1);if(a)return k(a.id);const n=e.grades.find(r=>k(r.id).toLowerCase().includes("rebut")&&r.valid);if(n&&e.grades.some(r=>r.valid&&r.id!==n.id)){const r=e.grades.find(B=>B.valid&&B.id!==n.id);return k(r.id)}if(n||e.grades.some(r=>r.valid!==void 0))return"Rebut"}return"Ungraded"}return w.value.find(a=>a.id===e.gradeId)?.name||`Grade ${e.gradeId}`},P=e=>{if(!e)return"Unknown";if(e.specie){if(typeof e.specie=="object"&&e.specie.name)return e.specie.name;if(typeof e.specie=="string")return e.specie}if(e.species){if(typeof e.species=="object"&&e.species.name)return e.species.name;if(typeof e.species=="string")return e.species}return"Unknown"},H=e=>{const t=z(e.length),a=z(e.width);return`${t} Ã— ${a}`},z=e=>{if(!e)return"N/A";if(typeof e=="object"&&e.value){const a=parseFloat(e.value),n=e.unit||"cm";return n==="cm"?`${a.toFixed(1)} cm`:n==="mm"?`${(a/10).toFixed(1)} cm`:`${a.toFixed(1)} ${n}`}return`${(e/10).toFixed(1)} cm`},X=e=>e?new Date(e).toLocaleDateString():"N/A",Z=e=>{const t=L(e);return t.includes("A")?"bg-emerald-100 text-emerald-700":t.includes("B")?"bg-blue-100 text-blue-700":t.includes("C")?"bg-amber-100 text-amber-700":t.toLowerCase().includes("rebut")?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"},U=E(()=>{c.value=1},300);return ee(()=>{(async()=>{await Promise.all([W(),M()])})()}),(e,t)=>(u(),g("div",he,[t[14]||(t[14]=s("div",{class:"mb-8"},[s("h1",{class:"text-4xl font-extrabold text-gray-900 mb-2"},"Board Finder"),s("p",{class:"text-gray-600 mt-1"},"Find and analyze boards as they move through the scanning line")],-1)),s("div",ye,[s("div",be,[s("div",_e,[s("div",we,[o(d(ce),{class:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"}),te(s("input",{type:"text",placeholder:"Search by board ID, order, grade...","onUpdate:modelValue":t[0]||(t[0]=a=>b.value=a),onInput:t[1]||(t[1]=(...a)=>d(U)&&d(U)(...a)),class:"pl-10 pr-3 py-2 w-full border border-input rounded-lg focus:ring-2 focus:ring-ring focus:border-ring"},null,544),[[se,b.value]])]),o(I,{variant:"outline",onClick:q,class:C($.value?"border-emerald-500 text-emerald-700":"")},{default:h(()=>[o(d(ue),{class:"w-4 h-4 mr-2"}),t[3]||(t[3]=m(" Filters ",-1)),$.value?(u(),g("span",ke," Active ")):ae("",!0)]),_:1,__:[3]},8,["class"]),o(I,{onClick:M,variant:"outline"},{default:h(()=>[o(d(ge),{class:C([_.value?"animate-spin":"","w-4 h-4 mr-2"])},null,8,["class"]),t[4]||(t[4]=m(" Refresh ",-1))]),_:1,__:[4]})])])]),s("div",Be,[s("div",Ce,[s("div",Ie,[s("div",Ne,[s("div",Fe,[s("h3",De," Boards ("+l(p.value.length)+") ",1),s("span",Ae," Page "+l(c.value)+" of "+l(D.value),1)])]),s("div",Le,[_.value?(u(),g("div",Ge,t[5]||(t[5]=[s("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600 mx-auto"},null,-1),s("p",{class:"text-gray-600 mt-2"},"Loading boards...",-1)]))):j.value.length===0?(u(),g("div",Re," No boards found ")):(u(),g("div",Se,[(u(!0),g(re,null,ne(j.value,a=>(u(),g("div",{key:a.id,onClick:n=>T(a),class:C(["px-4 py-3 border-b border-gray-100 cursor-pointer transition-colors",f.value?.id===a.id?"bg-emerald-50 border-emerald-300":"hover:bg-gray-50"])},[s("div",Ve,[s("div",je,[s("div",Me,[s("span",Te,"Board #"+l(a.id),1),s("span",Pe,"Order "+l(a.batch?.id||"N/A"),1)]),s("div",ze,[s("span",Ue,l(P(a)),1),s("span",Ee,l(H(a)),1)])]),s("div",Oe,[s("span",{class:C(["inline-block px-2 py-1 text-xs font-medium rounded-full",Z(a)])},l(L(a)),3),s("div",We,l(X(a.createDate)),1)])])],10,$e))),128))]))]),s("div",qe,[s("div",Je,[o(I,{size:"sm",variant:"outline",onClick:J,disabled:c.value<=1},{default:h(()=>t[6]||(t[6]=[m(" Previous ",-1)])),_:1,__:[6]},8,["disabled"]),s("span",Ke,l(A.value+1)+"-"+l(V.value)+" of "+l(p.value.length),1),o(I,{size:"sm",variant:"outline",onClick:K,disabled:c.value>=D.value},{default:h(()=>t[7]||(t[7]=[m(" Next ",-1)])),_:1,__:[7]},8,["disabled"])])])])]),s("div",Qe,[f.value?(u(),oe(ie,{key:1,ref_key:"boardViewerRef",ref:F,board:f.value,"available-grades":w.value,"show-kpis":!0,onUsableAreaToggled:Y},{actions:h(()=>[s("button",He,[o(d(fe),{class:"w-4 h-4 mr-2"}),t[10]||(t[10]=m(" Agree with NG AI ",-1))]),s("button",{onClick:t[2]||(t[2]=()=>{F.value&&(F.value.showFeedbackModal=!0)}),class:"flex items-center px-3 py-1.5 text-sm font-medium text-gray-600 bg-white border-2 border-gray-300 rounded-md hover:bg-gray-50 transition-colors"},[o(d(ve),{class:"w-4 h-4 mr-2"}),t[11]||(t[11]=m(" Disagree with NG AI ",-1))]),s("button",Xe,[o(d(xe),{class:"w-4 h-4 mr-2"}),t[12]||(t[12]=m(" Add to Reference Bundle ",-1))]),s("button",{onClick:Q,class:"flex items-center px-3 py-1.5 text-sm font-medium text-emerald-600 bg-white border-2 border-emerald-300 rounded-md hover:bg-emerald-50 transition-colors"},[o(d(pe),{class:"w-4 h-4 mr-2"}),t[13]||(t[13]=m(" Open in Inspector ",-1))])]),_:1},8,["board","available-grades"])):(u(),g("div",Ye,[o(d(me),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),t[8]||(t[8]=s("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No Board Selected",-1)),t[9]||(t[9]=s("p",{class:"text-gray-500"},"Select a board from the list to view details",-1))]))])])]))}},nt=de(Ze,[["__scopeId","data-v-bc37dcc8"]]);export{nt as default};
